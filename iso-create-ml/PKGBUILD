# Maintainer : manuel at endeavouros.com

pkgname=iso-create-ml
pkgver=0.26.19
pkgrel=1
pkgdesc="Create a mirrorlist for the ISO"
arch=('any')
license=('GPL3')
depends=(eos-bash-shared parallel curl reflector)
source=(
    create-ml
    create-ml.bash-completion
    create-ml-rankmirrors-arch
    create-ml.conf
    create-ml-country-mapping-arch.conf
    create-ml-active-mirrors-arch.conf
)
sha256sums=('9c55f71a7b5a1ec6c38fbe26c47a079027190f7eb75eb0b2d287424ebe699d2d'
            '4af79c7128c1566e26951ad97e468fc5ef62588c6b76fdd8036982cdc7bc5086'
            '7036b26376843a63d3be7a5d472992c67979a1efcd7789c0316a8f4ca00324cf'
            '05fde2683a4cb5c801462405418fd0bd299a6b40cc451cf3754268e20131edb1'
            '5776615fa666b708161de831f334469c003bdb81fc95afa4ad26faa8f7675f56'
            '81e8c2ee6442ed38a98a26ae7f82bbe3d65a8808fd4506a9f7e8a80ccceed6b9')

_prepare_iso_create_ml() {
    local _markerfile=/tmp/tmp.IpJD89lkjMNB3BaY
    [ -r $_markerfile ] && return 0
    touch $_markerfile

    local _program=${source[0]}
    local _cmd="$_program --update-supports"
    if pgrep assets.make >/dev/null ; then
        $_cmd 2>/dev/null
    else
        $_cmd
    fi
    return 0
}
_prepare_iso_create_ml

package() {
    local src
    for src in "${source[@]}" ; do
        src=${src##*/}
        case "$src" in
            *.bash-completion) install -Dm644 "$src"  "$pkgdir/usr/share/bash-completion/completions/${src%.bash-completion}" ;;
            *.conf)            install -Dm644 "$src"  "$pkgdir/etc/$src" ;;
            *)                 install -Dm755 "$src"  "$pkgdir/usr/bin/$src" ;;
        esac
    done
}
